# RFM-анализ клиентской базы аптечной сети

## Бизнес-задача
Аптечная сеть планирует персонализированную маркетинговую кампанию в период сезонного спада продаж (межсезонье).  
Цель: сегментировать клиентов по поведению и предложить целевые действия для повышения retention и выручки.

## Используемые метрики (RFM)
- **Recency** — дни с последней покупки  
- **Frequency** — количество покупок  
- **Monetary** — суммарные траты клиента  

Пороговые значения определены на основе распределения данных (перцентили) и специфики аптечного рынка (частые покупки лекарств, сезонность).

- Recency: 1 (≤20 дней — Активные), 2 (≤80 дней — Уменьшающаяся активность), 3 (>80 дней — Спящие)  
- Frequency: 1 (≥11 покупок — Частые), 2 (≥5 — Умеренные), 3 (<5 — Редкие)  
- Monetary: 1 (≥3316 руб — Высокий чек), 2 (≥1477 — Средний), 3 (<1477 — Низкий)

## Подход
1. Очистка данных (фильтр валидных карт лояльности ~ '^[0-9]+$')  
2. Расчёт RFM-метрик в PostgreSQL  
3. Классификация на 27 RFM-групп  
4. Агрегация в 4 бизнес-сегмента: VIP, Постоянные, Спящие, Уходящие (экспертная сегментация по бизнес-логике)  
5. Визуализация в Metabase (дашборд с фильтрами по датам, авторефрешем)

## Ключевые выводы
- Небольшая доля VIP-клиентов (1-1-1) формирует значительную часть выручки (Pareto-подобный эффект).  
- Сегмент "Спящие" имеет высокий потенциал реактивации.  
- "Уходящие" требуют минимальных вложений.

## Рекомендации бизнесу
- **VIP** — программы лояльности, ранний доступ к новинкам/акциям  
- **Постоянные** — апселл/кросс-селл (доп. товары к рецептам)  
- **Спящие** — реактивационные промокоды, напоминания о сезонных товарах  
- **Уходящие** — минимальные коммуникации или исключение из дорогих рассылок  

Через 2–3 месяца — повторный анализ для оценки эффекта.

## Инструменты
- PostgreSQL (CTE, CASE, агрегации)  
- Metabase (дашборд с 4+ визуализациями: барчарты, таблицы, фильтры)  
- GitHub для версионного контроля

## Дашборд
[Скриншоты в /dashboard/screenshots/]

## SQL-витрина
См. sql/rfm_analysis.sql — основной запрос для расчёта RFM и сегментов.
